<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Functions Test</title>
    <link rel="stylesheet" href="frontend/static/css/completed-work.css">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .test-result { margin: 10px 0; padding: 10px; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>üé® Frontend Functions Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Completed Work Card Rendering</h2>
        <div id="test-card-container"></div>
        <div id="test1-result" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Modal Functionality</h2>
        <button onclick="testModal()">Test Modal</button>
        <div id="test2-result" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Utility Functions</h2>
        <div id="test3-result" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 4: CSS Styling</h2>
        <div id="test4-result" class="test-result"></div>
    </div>

    <script>
        // Mock app object with required functions
        class MockZavionApp {
            constructor() {
                this.currentSuggestions = [
                    {
                        id: 1,
                        title: "‚úÖ Completed: Financial Analysis Report",
                        description: "I analyzed your Q3 financial data and created a comprehensive performance report",
                        has_completed_work: true,
                        completed_work_content: "QUARTERLY FINANCIAL ANALYSIS\n\nRevenue: $2,450,000\nExpenses: $1,890,000\nProfit Margin: 22.9%",
                        completed_work_type: "markdown",
                        completed_work_preview: "Comprehensive quarterly financial analysis...",
                        action_label: "View Financial Report",
                        executor_type: "financial_analysis",
                        created_at: new Date().toISOString()
                    }
                ];
            }
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            getTimeAgo(date) {
                return "2 min ago";
            }
            
            formatWorkType(workType) {
                const typeMap = {
                    'text': 'Text',
                    'markdown': 'Markdown',
                    'json': 'JSON',
                    'html': 'HTML',
                    'csv': 'CSV'
                };
                return typeMap[workType] || 'Document';
            }
            
            formatExecutorType(executorType) {
                const executorMap = {
                    'financial_analysis': 'Financial Analyst',
                    'code_analysis': 'Code Analyst',
                    'data_analysis': 'Data Analyst'
                };
                return executorMap[executorType] || 'AI Assistant';
            }
            
            showToast(message, type) {
                console.log(`Toast: ${message} (${type})`);
            }
            
            viewCompletedWork(index) {
                if (!this.currentSuggestions || !this.currentSuggestions[index]) return;
                
                const suggestion = this.currentSuggestions[index];
                this.showCompletedWorkModal(suggestion);
            }
            
            showCompletedWorkModal(suggestion) {
                // Create modal
                const modal = document.createElement('div');
                modal.className = 'completed-work-modal-overlay';
                modal.innerHTML = `
                    <div class="completed-work-modal">
                        <div class="modal-header">
                            <h3>${this.escapeHtml(suggestion.title)}</h3>
                            <button class="modal-close" onclick="this.parentElement.parentElement.parentElement.remove()">√ó</button>
                        </div>
                        <div class="modal-content">
                            <div class="completed-work-content">
                                ${this.escapeHtml(suggestion.completed_work_content || suggestion.description).replace(/\n/g, '<br>')}
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button class="primary-btn" onclick="this.parentElement.parentElement.parentElement.remove()">Close</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                return modal;
            }
            
            renderSuggestionCard(suggestion, index, type = 'completed_work') {
                const isCompletedWork = suggestion.has_completed_work || suggestion.category === 'completed_work';
                
                if (isCompletedWork) {
                    const actionLabel = suggestion.action_label || 'View Results';
                    const preview = suggestion.completed_work_preview || suggestion.description;
                    const workType = suggestion.completed_work_type || 'text';
                    const executorType = suggestion.executor_type || 'unknown';
                    
                    return `
                        <div class="suggestion-card completed-work-card" data-suggestion-index="${index}">
                            <div class="completed-work-header">
                                <div class="work-title-section">
                                    <h4 class="completed-work-title">${this.escapeHtml(suggestion.title)}</h4>
                                    <div class="work-type-badge">
                                        ${this.formatWorkType(workType)}
                                    </div>
                                </div>
                                <div class="completion-indicator">
                                    <span>Ready</span>
                                </div>
                            </div>
                            <div class="completed-work-preview">
                                ${this.escapeHtml(preview)}
                            </div>
                            <div class="completed-work-actions">
                                <button class="primary-action-btn" onclick="window.mockApp.viewCompletedWork(${index})">
                                    ${actionLabel}
                                </button>
                                <div class="work-metadata">
                                    <span class="executor-badge">
                                        ${this.formatExecutorType(executorType)}
                                    </span>
                                    <span class="time-badge">
                                        ${this.getTimeAgo(new Date(suggestion.created_at))}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                return '<div>Not a completed work card</div>';
            }
        }
        
        // Initialize mock app
        window.mockApp = new MockZavionApp();
        
        // Test 1: Card Rendering
        function testCardRendering() {
            const container = document.getElementById('test-card-container');
            const suggestion = window.mockApp.currentSuggestions[0];
            
            try {
                const cardHtml = window.mockApp.renderSuggestionCard(suggestion, 0);
                container.innerHTML = cardHtml;
                
                // Verify card elements exist
                const card = container.querySelector('.completed-work-card');
                const title = container.querySelector('.completed-work-title');
                const preview = container.querySelector('.completed-work-preview');
                const button = container.querySelector('.primary-action-btn');
                
                if (card && title && preview && button) {
                    document.getElementById('test1-result').innerHTML = '‚úÖ PASS: Completed work card rendered correctly';
                    document.getElementById('test1-result').className = 'test-result pass';
                    return true;
                } else {
                    document.getElementById('test1-result').innerHTML = '‚ùå FAIL: Missing card elements';
                    document.getElementById('test1-result').className = 'test-result fail';
                    return false;
                }
            } catch (e) {
                document.getElementById('test1-result').innerHTML = `‚ùå FAIL: ${e.message}`;
                document.getElementById('test1-result').className = 'test-result fail';
                return false;
            }
        }
        
        // Test 2: Modal Functionality
        function testModal() {
            try {
                const suggestion = window.mockApp.currentSuggestions[0];
                const modal = window.mockApp.showCompletedWorkModal(suggestion);
                
                // Check if modal was created
                if (modal && modal.className === 'completed-work-modal-overlay') {
                    document.getElementById('test2-result').innerHTML = '‚úÖ PASS: Modal created successfully';
                    document.getElementById('test2-result').className = 'test-result pass';
                    
                    // Auto-close modal after 2 seconds
                    setTimeout(() => {
                        modal.remove();
                    }, 2000);
                    
                    return true;
                } else {
                    document.getElementById('test2-result').innerHTML = '‚ùå FAIL: Modal not created';
                    document.getElementById('test2-result').className = 'test-result fail';
                    return false;
                }
            } catch (e) {
                document.getElementById('test2-result').innerHTML = `‚ùå FAIL: ${e.message}`;
                document.getElementById('test2-result').className = 'test-result fail';
                return false;
            }
        }
        
        // Test 3: Utility Functions
        function testUtilityFunctions() {
            try {
                const workType = window.mockApp.formatWorkType('markdown');
                const executorType = window.mockApp.formatExecutorType('financial_analysis');
                const timeAgo = window.mockApp.getTimeAgo(new Date());
                
                if (workType === 'Markdown' && executorType === 'Financial Analyst' && timeAgo) {
                    document.getElementById('test3-result').innerHTML = '‚úÖ PASS: All utility functions working';
                    document.getElementById('test3-result').className = 'test-result pass';
                    return true;
                } else {
                    document.getElementById('test3-result').innerHTML = '‚ùå FAIL: Utility functions not working correctly';
                    document.getElementById('test3-result').className = 'test-result fail';
                    return false;
                }
            } catch (e) {
                document.getElementById('test3-result').innerHTML = `‚ùå FAIL: ${e.message}`;
                document.getElementById('test3-result').className = 'test-result fail';
                return false;
            }
        }
        
        // Test 4: CSS Styling
        function testCSSStyling() {
            try {
                // Check if CSS classes are defined
                const testDiv = document.createElement('div');
                testDiv.className = 'completed-work-card';
                document.body.appendChild(testDiv);
                
                const styles = window.getComputedStyle(testDiv);
                const hasBackground = styles.background !== 'rgba(0, 0, 0, 0)';
                const hasBorder = styles.border !== '0px none rgb(0, 0, 0)';
                
                document.body.removeChild(testDiv);
                
                if (hasBackground || hasBorder) {
                    document.getElementById('test4-result').innerHTML = '‚úÖ PASS: CSS styling applied';
                    document.getElementById('test4-result').className = 'test-result pass';
                    return true;
                } else {
                    document.getElementById('test4-result').innerHTML = '‚ùå FAIL: CSS styling not applied';
                    document.getElementById('test4-result').className = 'test-result fail';
                    return false;
                }
            } catch (e) {
                document.getElementById('test4-result').innerHTML = `‚ùå FAIL: ${e.message}`;
                document.getElementById('test4-result').className = 'test-result fail';
                return false;
            }
        }
        
        // Run all tests when page loads
        window.addEventListener('load', function() {
            console.log('üé® Running Frontend Functions Tests...');
            
            setTimeout(() => {
                const test1 = testCardRendering();
                const test3 = testUtilityFunctions();
                const test4 = testCSSStyling();
                
                const passedTests = [test1, test3, test4].filter(Boolean).length;
                const totalTests = 3;
                
                console.log(`Frontend Tests: ${passedTests}/${totalTests} passed`);
                
                if (passedTests === totalTests) {
                    console.log('üéâ ALL FRONTEND TESTS PASSED');
                } else {
                    console.log('‚ùå SOME FRONTEND TESTS FAILED');
                }
            }, 100);
        });
    </script>
</body>
</html>